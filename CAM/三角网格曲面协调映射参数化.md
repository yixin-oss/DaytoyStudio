---
title: 三角网格曲面协调映射参数化
---

## 曲面参数化

- "参数化"，通俗理解就是将三维曲面展平成二维平面，在这个过程中要注意满足拓扑、角度、三角形面积等的约束.
- 参数化最常见的用途就是做纹理映射(贴图映射), 要把一张二维贴图对应到三维网格曲面上, 在计算机中需要找到贴图每个颜色点贴到网格面上具体的空间坐标，而参数化展开得到的二维平面就是作为这个过程的中间媒介来使用的, 参见下图.

<img src="https://gitee.com/yixin-oss/blogImage/raw/master/Img/image-20241215152920148.png" alt="image-20241215152920148" style="zoom:50%;" />

- 参数化方法可以分为两大类, 即**固定边界法**和**自由边界法**, 参见下图.

<img src="https://gitee.com/yixin-oss/blogImage/raw/master/Img/image-20241215153004093.png" alt="image-20241215153004093" style="zoom:50%;" />

固定边界法, 即先将三角网格曲面的边界映射到预先定义好的多边形或圆域的边界上, 然后通过最小化整个三角网格的拉伸能量来参数化内部点, 这种方法相比于自由边界法的计算效率更高, 但参数化效果会差, 因为固定的边界通常会导致网格拉伸的形变损失.

- 对边界映射的处理通常是提取三角网格曲面的边界, 通过累加弦长法计算每个点的比例再对应到正方形或单位圆上.

- 典型的网格参数化方法有: Floater保形参数化, Harmonic参数化, Intrinsic参数化(固定和自由边界均可)等.

- 在众多的平面参数化方法中, CAM中的加工路径规划流程更倾向于应用协调映射的主要原因是
  - 平面域的固定边界可以是圆和多边形等二维封闭图形，有利于规划边界一致的加工路径来满足精度要求;
  - 协调映射以能量极小化的形式保证了最小变形程度;
  - 协调映射可以保证空间网格映射到平面不自交, 有利于加工路径规划;
  - 算法实现简单, 只需要求解大型稀疏线性方程组.

下面将着重介绍最常见的Harmonic参数化方法.

## Harmonic参数化

- 固定边界法

- 基本思想: 将三角网格中每条边看作一个弹簧,先将三角网格边界映射到预先定义好的凸多边形或圆周上，然后通过最小化整个三角网格的弹性势能来参数化内部点.

- 数学背景: 对于两个拓扑同胚的任意曲面, 总存在某种映射关系,使两个曲面上的点一一对应. 假设$M,N$是两个黎曼流形, $g, h$分别是定义在其上的黎曼度量. $f(M,g)\rightarrow (N,h)$是定义在两个黎曼流形上的光滑映射函数, 则$f$的离散调和能为
  $$
  E_g(f)=\frac{1}{2}\int_M|df|^2_g\rm dA_g.
  $$
  对于三角网格曲面$T=\{T_\alpha,\alpha=0,...,m\}$(三角片集合), 离散调和能为
  $$
  \begin{equation}
  E_{g}(f)=\frac{1}{2}\sum_{\alpha}\int_{T_{\alpha}}|\rm df|_{g}^{2}dA_{g}=\frac{1}{2}\sum_{i,j}w_{i,j}^{\alpha}|f(v_i)-f(v_j)|^{2}.
  \end{equation}
  $$

- 直观理解: 将网格曲面看成由$(m+1)$个三网形橡胶片沿看它们边拼接而成的一个具有弹性的橡胶块. 映射$f:M\rightarrow N$将橡胶块挤压或拉伸成另一张曲面, 调和能$E_{g}(f)$即反应整个过程中的变形能量.

<img src="https://gitee.com/yixin-oss/blogImage/raw/master/Img/image-20241212115934470.png" alt="image-20241212115934470" style="zoom: 40%;" />

- 算法流程

  (1) 边界点快速提取: 基于边栈比较

  - 初始边栈将所有边压入栈中, 初始化边池;
  - 从边栈中弹出一边, 依次与边池中的边进行比较: 如果边池为空则直接将该边放入池中;如果当前边与边池中某一条边索引相同，则说明当前边是内边，这时就从边池中删除该边; 如果与边池中所有边索引都不同，则将该边放入边池中;
  - 重复上述步骤, 直到边栈弹空. 此时, 边池中全部是边界边, 可以通过边界边得到边界边的索引找到边界边对应的顶点, 形成边界边的顶点集合.

  (2) 边界点映射

  有先将网格曲面边界顶点$V_i$进行累加弦长参数化, 然后映射到单位正方形上.
  $$
  \begin{equation}
  t_{i}=\frac{\sum_{j=1}^{i-1}|V_{j+1}-V_{j}|}{\sum_{j=1}^{n-1}|V_{j+1}-V_{j}|}.
  \end{equation}
  $$

  - 将边界顶点向单位正方形对应, 逆时针顺序按比例对应到参数域边界
    $$
    (u_{i},v_{i})=
    \begin{cases}
    (0.5-4t_{i},0.5),& t_{i}\in[0.0.25),\\(-0.5,1.5-4t_{i}),&t_{i}\in[0.25,0.5),\\(4t_{i}-2.5,-0.5),&t_{i}\in[0.5,0.75),\\(0.5,4t_{i}-3.5),&t_{i}\in[0.75,1].
    \end{cases}
    $$

  - 若向单位圆域参数化, 则有
    $$
    (u_i,v_i)=(\cos(2\pi t_i),\sin(2\pi t_i)).
    $$

  (3) 内部点映射: 基于离散调和能极小化的最小二乘问题
  $$
  E(f)=\frac{1}{2}\sum_{ v_j\in \rm adj(v_i)} w_{i,j}|f(v_{i})-f(v_{j})|^{2}
  $$
  其中$w_{i,j}$为弹性系数, 由三角面片的几何信息决定,i.e.,
  $$
  \begin{equation}
  w_{i,j}=\frac{L_{i,k_{1}}^2+L_{j,k_{1}}^2-L_{ij}^2}{S_{\Delta V_iV_{j}V_{k_{1}}}}+\frac{L_{i,k_{2}}^{2}+L_{j,k_{2}}^{2}-L_{ij}^{2}}{S_{\Delta V_{i}V_{j}V_{k_{2}}}}.
  \end{equation}
  $$
  接下来, 为了计算简便, 可选取$x-y$坐标平面($z=0$)为映射平面, 则有
  $$
  \begin{equation}
  E(f)=\frac{1}{2}\sum_{i,j}w_{i,j}[(x_{i}-x_{j})^{2}+(y_{i}-y_{j})^{2}]
  \end{equation}
  $$
  即最小二乘问题
  $$
  \begin{aligned}
  \frac{\partial E(f_{1})}{\partial x_{i}}&=\sum_{v_j\in \rm adj(v_{i})}w_{i,j}(x_{i}-x_{j})=0,\\
  \frac{\partial E(f_{1})}{\partial y_{i}}&=\sum_{v_j\in \rm adj(v_{i})}w_{i,j}(y_{i}-y_{j})=0,\\
  &\qquad \vdots\\
  \frac{\partial E(f_{1})}{\partial x_{n}}&=\sum_{v_j\in \rm adj(v_{n})}w_{n,j}(x_{n}-x_{j})=0,\\
  \frac{\partial E(f_{1})}{\partial y_{i}}&=\sum_{v_j\in \rm adj(v_{n})}w_{n,j}(y_{n}-y_{j})=0.\\
  \end{aligned}
  $$

  <center class="half">
      <img src="https://gitee.com/yixin-oss/blogImage/raw/master/Img/TriMeshsurface.png" width="300"/>
      <img src="https://gitee.com/yixin-oss/blogImage/raw/master/Img/boundarymap.png" width="300"/>
      <img src='https://gitee.com/yixin-oss/blogImage/raw/master/Img/Harmonic_Pointsmap.png' width='300' style="zoom:85%;">
      <img src='https://gitee.com/yixin-oss/blogImage/raw/master/Img/Flatten_mesh.png' width='300'>
  </center>

**存在的问题**: 边界参数化的均匀性

以上过程中, 边界的参数化是至关重要的, 直接决定了整体参数化的效果, 但部分例子的边界点参数化会在局部区域分布密集导致参数化失败, 如何确保边界参数化的均匀性还在解决？

